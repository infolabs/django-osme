!function(e){var f,l,p,c,i,s,a=(f=0,l=1e-6,p=2,c=1/65535,i="/api/0.6/relation/",s={},{setHost:function(e){i=e},coordinateDecode:b,geometryCombine:w,flipCoordinate:h,recombine:m,geoJSON:function(e,t,r,n){n=n||function(e){window.console&&console.error(e)};var o,a=i+e+"/full";!s[a]||t.nocache?(o=this).loadData(a,function(e){s[a]=e,u(r,[o.parseData(e,t),e])},n):u(r,[this.parseData(s[a],t),s[a]])},loadData:function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||304===n.status)try{var e=n.responseText;t(e)}catch(e){r(e)}else window.console&&console.error("Response recieved with status "+n.status),r(n)},n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send()},parseData:function(e,t){return{type:"FeatureCollection",features:function(e,t){t=t||{};var r,n=e.regions,o=[],a=t.postFilter||(e.meta&&e.meta.postFilter?new Function("region",e.meta.postFilter):0),i=t.scheme||e.meta&&e.meta.scheme,s=e.meta&&e.meta.disputedBorders||{},u="string"==typeof(t=t.recombine||t.lang||"en")?s[t]:t,f=0;for(d in s){var l,p=s[d];for(l in p){var c=p[l];"string"==typeof c&&(p[l]=new Function("region",c))}}for(d in n)n.hasOwnProperty(d)&&(a&&!a(C(d,e))||(f=u&&u[+d]?m(e,{filter:u[+d]}):i&&i[+d]?m(e,{filter:"string"==typeof(r=i[+d])?new Function("region",r):r}):w(+d,e),o[n[d].index]={type:"Feature",geometry:f,properties:{osmId:d,level:n[d].level,properties:n[d].property||{},parents:n[d].parents,hintContent:n[d].name,name:n[d].name,title:n[d].name,wikipedia:n[d].wikipedia,orderIndex:n[d].index,square:n[d].square}}));for(var h=[],d=0,g=o.length;d<g;++d)o[d]&&h.push(o[d]);return h}(e,t),metaData:e.meta}},dropCache:function(){s={}},_setCoordOrder:function(e){f="latlong"==e},toYandex:function(e,t){for(var r,o=new(t=t||ymaps).GeoObjectCollection,n=e.features,a=g(e),i=0,s=n.length;i<s;++i){var u=n[i];u.geometry?o.add(new t.GeoObject(f?u:{type:"Feature",geometry:{type:"Polygon",fillRule:1<(r=u).geometry.coordinates.length?"evenOdd":"nonZero",coordinates:h(r.geometry.coordinates)},properties:r.properties},{simplificationFixedPoints:u.geometry.fixedPoints})):window.console&&console.log("osme line fail",u)}return{collection:o,add:function(e){e.geoObjects.add(o)},remove:function(){o.setParent(null)},setStyles:function(t){o.each(function(e){e.options.set(t(a[e.properties.get("osmId")],e))})},addEvent:function(r,n){o.events.add(r,function(e){var t=e.get("target");n(a[t.properties.get("osmId")],[r,"yandex"],t,e)})},removeEvent:function(e){o.events.remove(e)}}},toGoogle:function(e,t){var o=g(e),a=new(t||google.maps).Data;return a.addGeoJson(e),{collection:a,add:function(e){a.setMap(e)},remove:function(){a.setMap(null)},setStyles:function(t){a.setStyle(function(e){return function(e){var t={};"strokeWidth"in e&&(t.strokeWeight=e.strokeWidth);"fillColor"in e&&(t.fillColor=e.fillColor);"strokeColor"in e&&(t.strokeColor=e.strokeColor);"strokeOpacity"in e&&(t.strokeOpacity=Math.max(.001,e.strokeOpacity));"fillOpacity"in e&&(t.fillOpacity=Math.max(.001,e.fillOpacity));return t}(t(o[e.getProperty("osmId")],e))})},addEvent:function(r,n){a.addListener(r,function(e){var t=e.feature;n(o[t.getProperty("osmId")],[r,"google"],t,e)})},removeEvent:function(e){a.removeListener(e)}}}});function h(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=function(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=[e[r][1],e[r][0]];return t}(e[r]);return t}function d(e,t){for(var r=0,n=0;n<t;++n)r|=e.charCodeAt(n)<<8*n;return r}function b(e){var t=(e=(e=e).replace(/_/g,"/").replace(/-/g,"+"),"undefined"!=typeof atob?atob(e):new Buffer(e,"base64").toString("binary")),r=t.length,n=[[d(t.substr(0,4),4)*l,d(t.substr(4,4),4)*l],[d(t.substr(8,4),4)*l,d(t.substr(12,4),4)*l]],e=[n[1][0]-n[0][0],n[1][1]-n[0][1]],o=[],a=16,i=e[0]*c,s=e[1]*c;function u(){var e=d(t.substr(a,p),p);return a+=p,e}for(;a<r;){var f=[(f=u()*i+n[0][0],Math.min(85,Math.max(-85,f))),(f=u()*s+n[0][1],Math.min(180,Math.max(-180,f)))];o.push([f[1],f[0]])}return o}function w(e,t){var r=[],n=[],o=[],a=e.length?e:t.paths[e],i=t.ways;if(t.wayCache=t.wayCache||{},!a)return!1;for(var s,u,f=0,l=a.length;f<l;++f){var p=a[f],c=[],h=[],d=[0];"number"==typeof p&&(p=[p]);for(var g=0,m=p.length;g<m;++g){var v=Math.abs(p[g]),y=(y=i[v],s=v,(u=t).wayCache[s]||(u.wayCache[s]=b(y)));p[g]<0&&(y=y.slice(0)).reverse(),c.length&&(c.length=c.length-1),c.push.apply(c,y),d.push(c.length-1),h.push(v)}c.push(c[0]),r.push(c),n.push(d),o.push(h)}return{type:"Polygon",fillRule:"nonZero",coordinates:r,path:a,fixedPoints:n}}function C(f,l){var o=l.regions[f],e=o.property||{};return{osmId:f,geoNamesId:e.geoNamesId,iso:e.iso3166,level:o.level,properties:e,getBorderWith:function(e){for(var t,r,n={},o=l.paths[e],a=l.paths[f],i=0,s=o.length;i<s;++i)for(t=0,r=o[i].length;t<r;++t)n[Math.abs(o[i][t])]=1;var u=[];for(i=0,s=a.length;i<s;++i)for(t=0,r=a[i].length;t<r;++t)n[Math.abs(a[i][t])]&&u.push(a[i]);return u},hasBorderWith:function(e){var t,r,n,o,a={},i=l.paths[f],s=l.paths[e];if(!i||!s)return!1;for(t=0,r=i.length;t<r;++t)for(n=0,o=i[t].length;n<o;++n)a[Math.abs(i[t][n])]=1;for(t=0,r=s.length;t<r;++t)for(n=0,o=s[t].length;n<o;++n)if(a[Math.abs(s[t][n])])return!0;return!1},hasParent:function(e){for(var t=o.parents,r=0,n=t.length;r<n;++r)if(t[r].id==e)return!0;return!1}}}function m(e,t){var r,n,o,a=e.regions,i=e.paths,s={},u=[];for(r in a)a.hasOwnProperty(r)&&(n=i[r],(o=t.filter(C(r,e)))&&(!0!==o&&o.path&&(n=o.path),n&&n.length&&(n=function(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push([e[r]]);return t}(n)).length&&(s[r]=r,u.push.apply(u,n))));u.sort(function(e,t){return Math.abs(e[0][0])<Math.abs(t[0][0])});for(var f=u[0],l={0:1},p=1,c=[],h=u.length,d=0,g=0,m=0;p<h;){g=0;for(var v=1,h=u.length;v<h;++v){var y,b=v%h;b in l||((y=function(e,t){for(var r={},i={},s={},n=[e,t],o=0;o<2;++o)for(var a=0,u=(c=n[o]).length;a<u;++a){"number"==typeof(h=c[a])&&(h=[h]);for(var f=0,l=h.length;f<l;++f)r[d=Math.abs(h[f])]=(r[d]||0)+1}for(var p=0,o=0;o<2;++o)for(var c,h,a=0,u=(c=n[o]).length;a<u;++a){"number"==typeof(h=c[a])&&(h=[h]);for(var d,g,m,f=0,l=h.length;f<l;++f)1===r[d=Math.abs(h[f])]?(g=+h[(f-1+l)%l],m=+h[(f+1+l)%l],s[g]=s[g]||[],s[g].push(h[f]),i[h[f]]=[+g,+h[f],+m,o,a]):p++}if(!p)return!1;function v(e){return e&&i.hasOwnProperty(e)&&i[e][1]}for(var y=[],b=[],w=1;!1!==(way=function(){for(var e in i)if(v(e))return+e;return!1}());){for(w=1,(b=[]).push(+way);way;){i[way][1]=0;var C=function(e,t){if(!i[t])return!1;var r=-1==w?i[t][0]:0,n=1==w?i[t][2]:0;if(v(n))t=n,e.push(+t*w);else if(v(r))t=r,e.push(+t);else{var o,a=s[-i[t][2]];for(o in t=0,a)if(v(n=a[o])){t=n,e.push(+t);break}if(!t)return!1}return t}(b,way);if(!C)break;way=C}y.push(b)}return y}(f,u[b]))&&1==y.length?(f=y,l[b]=1,p++,g++):d=b)}if(!g){if(!d)break;c.push(f[0]),f=u[d],l[d]=1,p++}if(1e3<m++)break}return f&&c.push(f[0]),w(c,e)}function u(e,t){setTimeout(function(){e.apply(this,t)},0)}function g(e){for(var t={},r=e.features,n=0,o=r.length;n<o;++n){var a=r[n];a&&a.properties&&(t[a.properties.osmId]=a)}return t}"object"==typeof exports?module.exports=a:e.osmeRegions=a,"object"==typeof ymaps&&ymaps.modules&&ymaps.modules.define&&(ymaps.modules.define("osmeRegions",["vow","system.project"],function(e,n,o){e(ymaps.osmeRegions={load:function(e,t){var r=n.defer();return t=t||{},a.geoJSON(e,{lang:t.lang||o.data.lang.substr(0,2),quality:"quality"in t?t.quality:0},function(e){r.resolve({geoObjects:a.toYandex(e).collection})},function(){r.reject()}),r.promise()}})}),ymaps.modules.require("osmeRegions",function(){}))}(this);